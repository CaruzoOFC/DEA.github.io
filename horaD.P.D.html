
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
	<meta http-equiv="Content-Language" content="pt-BR">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Procedimentos operacionais da Polícia Militar para abordagem de veículos e fiscalização de trânsito.">
    <meta name="keywords" content="Contabilizador de horas D.P.D">
    <meta name="author" content="Wellinton Jose - 25347">
  <title>Horas Trabalhadas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEJ6D7D4yR6bhA54RmBoc9h5dV6pqlh4+f6A04DkTw6+XmXSkYO9XQ8A7Y2z6" crossorigin="anonymous">
<style>
  body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 20px;
    text-align: center;
    color: #007BFF;
    background-color: transparent;
  }

  .container {
    max-width: 400px;
    margin: 0 auto;
    padding: 20px;
    background-color: transparent;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    position: relative;
  }

  h1 {
    font-size: 24px;
    color: #007BFF;
    margin-bottom: 20px;
  }

  .drop-area {
    width: 100%;
    height: 100px;
    border: 2px dashed #007BFF;
    border-radius: 8px;
    background-color: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #007BFF;
    font-size: 18px;
    font-weight: bold;
    transition: background-color 0.3s, border-color 0.3s;
  }

  .drop-area.dragover {
    background-color: #e9f4fe;
    border-color: #0056b3;
  }

  .buttons-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
  }

  .download-link {
    background-color: #007BFF;
    color: white;
    padding: 12px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    text-decoration: none;
    transition: background-color 0.3s;
    display: inline-block;
    position: absolute;
    top: 10px;
    right: 10px;
  }

  .download-link:hover {
    background-color: #3ea44f;
  }

  /* Estilo para cada item de resultado */
  .resultado-item {
    margin: 10px 0;
    padding: 10px;
    background-color: rgba(100,149,237, 0.5);
    border-radius: 30px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    font-size: 16px;
    color: rgba(128,128,128, 2);
    line-height: 1.4;
    text-align: center; /* Centraliza o texto */
  }

  /* Estilo do resultado */
  #result {
    margin-top: 20px;
    text-align: left;
    font-size: 16px;
    line-height: 1.3;
    color: rgba(128,128,128, 2);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    border-radius: 30px;
    background-color: transparent; /* Fundo transparente */
    max-width: 70%; /* Define a largura máxima como 100% da largura do contêiner */
    margin-left: auto; /* Centraliza horizontalmente */
    margin-right: auto; /* Centraliza horizontalmente */
  }

  .file-input {
    display: none;
  }

  .file-label {
    background-color: #007BFF;
    color: white;
    padding: 12px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    text-decoration: none;
    transition: background-color 0.3s;
  }

  .file-label:hover {
    background-color: #3ea44f;
  }

  /* Estilo do conteúdo */
  #content {
    background-color: transparent;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  /* Para garantir que o login tenha um fundo sólido e visível */
  .login-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    padding: 40px;
    width: 100%;
    max-width: 400px;
    background-color: transparent;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  h2 {
    color: white; /* Define a cor do texto como branco */
  }

  input {
    padding: 10px;
    font-size: 16px;
    margin: 10px 0;
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: transparent; /* Fundo dos campos transparente */
    color: white; /* Letras brancas */
  }

  input::placeholder {
    color: rgba(255, 255, 255, 0.7); /* Placeholder branco com transparência */
  }

  button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 10px;
  }

  button:hover {
    background-color: #45a049;
  }

  /* @media para telas menores que 768px */
  @media (max-width: 768px) {
    h1 {
        font-size: 24px;
    }

    .container {
        max-width: 95%;
        padding: 5px;
    }

    .container img {
        width: 100%;
        max-width: none;
    }

    .container p {
        font-size: 14px;
    }

    .download-link {
        font-size: 14px;
        padding: 10px 15px;
    }

    .buttons-container {
        flex-direction: column;
    }

    #result {
        max-width: 90%;
    }
  }

  /* @media para telas menores que 480px */
  @media (max-width: 480px) {
    h1 {
        font-size: 20px;
    }

    .container p {
        font-size: 12px;
    }

    .buttons-container {
        flex-direction: column;
        align-items: stretch;
    }

    .download-link {
        font-size: 14px;
        padding: 10px 15px;
    }

    #result {
        max-width: 100%;
    }
  }
</style>

</head>
<body>

  <!-- Tela de login -->
  <div class="login-container" id="loginContainer">
    <h2>Login</h2>
    <input type="text" id="usuario" placeholder="Usuário">
    <input type="password" id="senha" placeholder="Senha">
    <button onclick="login()">Entrar</button>
  </div>

  <!-- Página de conteúdo, inicialmente escondida -->
  <div id="content" style="display: none;">
    <div class="container">
      <h1>Horas Trabalhadas</h1>

      <!-- Link de Download com ícone -->
      <a id="downloadLink" class="download-link" style="display: none;" href="#" download="resultado_horas.txt">
        <i class="fas fa-download"></i>
      </a>

      <!-- Área de Drop -->
      <div id="dropArea" class="drop-area">
        Arraste e solte o arquivo aqui
      </div>
      
      <!-- Botão para Escolher Arquivo -->
      <input type="file" id="fileInput" class="file-input" onchange="processarArquivo(this.files[0])">
      <label for="fileInput" class="file-label">Escolher arquivo</label>

      <div id="result"></div>
    </div>
  </div>

<script>
  // Função para verificar o login
  function login() {
    var usuario = document.getElementById('usuario').value;
    var senha = document.getElementById('senha').value;

    if (usuario === 'DEA' && senha === '1414') {
      document.getElementById('loginContainer').style.display = 'none'; // Esconde o formulário de login
      document.getElementById('content').style.display = 'block'; // Exibe o conteúdo
    } else {
      alert('Usuário ou senha incorretos');
    }
  }

  // Função para converter tempo no formato "x hora(s) y minuto(s)" para formato "hh:mm"
  function converterTempoParaHorasMinutos(tempo) {
    let horas = 0, minutos = 0;
    
    let matchHoras = tempo.match(/(\d+)\s*(hora|h)/);
    if (matchHoras) {
      horas = parseInt(matchHoras[1]);
    }
    
    let matchMinutos = tempo.match(/(\d+)\s*(minuto|min|m)/);
    if (matchMinutos) {
      minutos = parseInt(matchMinutos[1]);
    }

    // Retorna no formato "hh:mm", com zero à esquerda se necessário
    return `${horas < 10 ? '0' + horas : horas}:${minutos < 10 ? '0' + minutos : minutos}`;
  }

  // Função para processar o arquivo de texto
  function processarArquivo(file) {
    var reader = new FileReader();
    
    reader.onload = function(e) {
      var dadosBrutos = e.target.result.trim();
      console.log("Dados Brutos Inseridos: ", dadosBrutos);

      // Remover qualquer ocorrência do termo "Bate Ponto" nos dados inseridos
      dadosBrutos = dadosBrutos.replace(/Bate Ponto/g, '').trim();

      // Regex para capturar nome e RG
      var regexNomeRG = /([A-Za-z\s]+)\s\((\d+)\)/g;
      // Regex para capturar tempo de serviço
      var regexTempo = /Tempo de serviço:\s*([\d\s\w]+)/g;

      var resultado = [];
      var resultadoTextoSimples = []; // Para armazenar o conteúdo em formato de texto simples

      let nomeRGMatch;
      let tempoMatch;
      while ((nomeRGMatch = regexNomeRG.exec(dadosBrutos)) !== null) {
        let nome = nomeRGMatch[1].trim();
        let rg = nomeRGMatch[2].trim();
        tempoMatch = regexTempo.exec(dadosBrutos);
        if (tempoMatch) {
          let tempo = tempoMatch[1];
          
          // Adiciona o formato HTML para exibição no site
          resultado.push(`
            <div class="resultado-item">
              ${nome} - ${rg}<br>
              Tempo de serviço: ${converterTempoParaHorasMinutos(tempo)}
            </div>
          `);

          // Adiciona o formato de texto simples para o download
          resultadoTextoSimples.push(`${nome} - ${rg}\nTempo de serviço: ${converterTempoParaHorasMinutos(tempo)}`);
        }
      }

      // Ordenar os resultados por nome (alfabeticamente)
      resultado.sort(function(a, b) {
        var nomeA = a.split(' - ')[0].toLowerCase();
        var nomeB = b.split(' - ')[0].toLowerCase();
        return nomeA.localeCompare(nomeB);
      });

      // Ordenar o conteúdo de texto simples também por nome (alfabeticamente)
      resultadoTextoSimples.sort(function(a, b) {
        var nomeA = a.split(' - ')[0].toLowerCase();
        var nomeB = b.split(' - ')[0].toLowerCase();
        return nomeA.localeCompare(nomeB);
      });

      // Exibindo o resultado no div com formatação HTML
      if (resultado.length > 0) {
        var resultDiv = document.getElementById('result');
        resultDiv.innerHTML = resultado.join(''); // Exibindo sem a linha <hr>

        // Habilitar link de download
        var downloadLink = document.getElementById('downloadLink');
        downloadLink.style.display = 'inline-block';
        
        // Criando um texto simples para download, já ordenado
        var textoParaDownload = resultadoTextoSimples.join('\n\n'); // Formato de texto simples
        var arquivoBlob = new Blob([textoParaDownload], { type: 'text/plain' });
        var arquivoURL = URL.createObjectURL(arquivoBlob);
        downloadLink.href = arquivoURL;
        
        // Resetar os resultados após o download
        downloadLink.onclick = function() {
          resultDiv.innerHTML = ''; // Limpa os resultados
          downloadLink.style.display = 'none'; // Oculta o link de download novamente
        };
      }
    };
    
    reader.readAsText(file);
  }

  // Estilos de interação com o drag-and-drop
  const dropArea = document.getElementById('dropArea');
  dropArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    dropArea.classList.add('dragover');
  });

  dropArea.addEventListener('dragleave', function() {
    dropArea.classList.remove('dragover');
  });

  dropArea.addEventListener('drop', function(e) {
    e.preventDefault();
    dropArea.classList.remove('dragover');
    let arquivo = e.dataTransfer.files[0];
    processarArquivo(arquivo);
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-GLhlTQ8iRAB+5zybZ2T5nD3oAKb5C6fFf5V5S1vH8b/6EwEXJ1tD0X6oABgE2mS5" crossorigin="anonymous"></script>
</body>
</html>
